{
    "collab_server" : "",
    "contents" : "---\ntitle: \"pmeasyr\"\nauthor: \"Guillaume Pressiat\"\ndate: 16/01/2017\noutput: rmarkdown::html_vignette\nvignette: >\n  %\\VignetteIndexEntry{Starting with pmeasyr}\n  %\\VignetteEngine{knitr::rmarkdown}\n  \\usepackage[utf8]{inputenc}\n---\n\n\nCette vignette documente les principes generaux pour l'utilisation du package *pmeasyr*.\n\n\n## 1 - Gestion des archives in / out des logiciels ATIH\n\nCette partie du package facilite la manipulation des archives PMSI, fichiers de type :\n\n  - finess.annee.mois.date_et_heure_de_creation.in.zip\n  - finess.annee.mois.date_et_heure_de_creation.out.zip\n\nLes fonctions permettent de dezipper les fichiers depuis R en ligne de commande, sans intervention manuelle de l'utilisateur. L'avantage est d'obtenir un processus ne relevant pas d'interventions externes au logiciel R (pour pouvoir garder trace des etapes, et faciliter la reproduction, tout est inscrit dans un programme, dans un flux de processus). Une fois que les traitements et analyses sur les fichiers sont faits, il est possible d'effacer les archives egalement en ligne de commande.\n\nLe nom des fonctions dont l'objectif est de manipuler les **a**rchives commence par **a**.\n\n|Nom       |Fonction                                                                               |\n|:---------|:--------------------------------------------------------------------------------------|\n|[adezip](https://github.com/IM-APHP/pmeasyr/tree/master/Rd_md/adezip.Rmd)    |~ *.zip - Dezippe des fichiers de larchive PMSI                                        |\n|[adezip2](https://github.com/IM-APHP/pmeasyr/tree/master/Rd_md/adezip2.Rmd)   |~ *.zip - Dezippe des fichiers de l'archive PMSI, avec en parametre le nom de l'archive|\n|[astat](https://github.com/IM-APHP/pmeasyr/tree/master/Rd_md/astat.Rmd)     |~ *.zip - Liste et volume des fichiers d'une archive PMSI                              |\n|[adelete](https://github.com/IM-APHP/pmeasyr/tree/master/Rd_md/adelete.Rmd)   |~ *.zip - Suppression des fichiers en fin de traitement                                |\n\n### adezip : dezipper\n\n```{r eval = F}\nlibrary(pmeasyr)\n# Dezippage de tous les fichiers du in 2015 \n# Ex : 750100042.2015.12.20160130.153012.in.zip\nadezip(finess = 750100042, \n       annee = 2015, \n       mois = 12, \n       path = '~/Documents/data/mco', \n       liste = \"\", \n       type = \"in\")\n\n# Dezippage uniquement des fichiers rsa, ano et tra du out 2015\n# Ex: 750100042.2015.12.20160130.153012.out.zip\nadezip(finess = 750100042, \n       annee = 2015, \n       mois = 12, \n       path = '~/Documents/data/mco', \n       liste = c(\"rsa\", \"ano\", \"tra\"), \n       type = \"out\")\n```\n\n### adelete : effacer\n\n```{r eval = F}\n# Effacer les fichiers\nadelete(finess = 750100042, \n        annee = 2015, \n        mois = 12, \n        path = '~/Documents/data/mco', \n        liste = c(\"rsa\", \"ano\"), \n        type = \"out\")\n```\n\n### astat : editer des statistiques\n\n```{r eval = F}\n# Informations sur les fichiers : Date de creation, Taille\nastat(path = '~/Documents/data/mco/', \n      file = '750100042.2015.12.29012016174032.out.zip', \n      view = F)\n```\n\n\n## 2 - Importer\n\nUne fois les fichiers extraits des .zip, on peut utiliser les fonctions d'imports.\n\nLe nom des fonctions permettant l'**i**mport des fichiers commence par **i**.\n\nEn MCO, SSR et HAD les fonctions permettent d'importer les fichiers aux formats de 2011 a 2016. En PSY et pour les RSF, de 2012 a 2016.\n\n\n### Champ MCO\n\n|Nom       |Fonction                           |\n|:---------|:----------------------------------|\n|[irsa](https://github.com/IM-APHP/pmeasyr/tree/master/Rd_md/irsa.Rmd)      |~ MCO - Import des RSA             |\n|[irum](https://github.com/IM-APHP/pmeasyr/tree/master/Rd_md/irum.Rmd)      |~ MCO - Import des RUM             |\n|[idiap](https://github.com/IM-APHP/pmeasyr/tree/master/Rd_md/idiap.Rmd)     |~ MCO - Import des DIAP            |\n|[idmi_mco](https://github.com/IM-APHP/pmeasyr/tree/master/Rd_md/idmi_mco.Rmd)  |~ MCO - Import des DMI             |\n|[iium](https://github.com/IM-APHP/pmeasyr/tree/master/Rd_md/iium.Rmd)      |~ MCO - Import des donnees UM      |\n|[ileg_mco](https://github.com/IM-APHP/pmeasyr/tree/master/Rd_md/ileg_mco.Rmd)  |~ MCO - Import des erreurs Leg     |\n|[imed_mco](https://github.com/IM-APHP/pmeasyr/tree/master/Rd_md/imed_mco.Rmd)  |~ MCO - Import des Med             |\n|[ipo](https://github.com/IM-APHP/pmeasyr/tree/master/Rd_md/ipo.Rmd)       |~ MCO - Import des PO              |\n|[iano_mco](https://github.com/IM-APHP/pmeasyr/tree/master/Rd_md/iano_mco.Rmd)  |~ MCO - Import des Anohosp         |\n\nLes donnees in / out sont prises en charge.\n\n#### RSA\n\n```{r eval = F}\n# Import des rsa 2015\nirsa(finess = 750100042, \n     annee = 2015, \n     mois = 12, \n     path = '~/Documents/data/mco')\n```\n\nSelon la nature des analyses a produire, plusieurs types d'imports sont possibles : \n\n| Type|Import                                                                               |\n|----:|:------------------------------------------------------------------------------------|\n|    1|Light      : Partie fixe                                                             |\n|    2|Light+     : Partie fixe + stream en ligne (+) actes et das                          |\n|    3|Light++    : Partie fixe + stream en ligne (++) actes, das, typaut um et dpdr des um |\n|    4|Standard   : Partie fixe + creation des tables actes, das et rsa_um                  |\n|    5|Standard+  : Partie fixe + creation des tables actes, das et rsa_um + stream (+)     |\n|    6|Standard++ : Partie fixe + creation des tables actes, das et rsa_um + stream (++)    |\n\n\n```{r eval = F}\n# Import des rsa 2015 type 6\nirsa(finess = 750100042, \n     annee = 2015, \n     mois = 12, \n     path = '~/Documents/data/mco', \n     typi = 6) -> rsa15\nView(rsa15$rsa)\nView(rsa15$rsa_um)\nView(rsa15$actes)\nView(rsa15$das)\n```\n\n#### RUM\n\n```{r eval = F}\n# Import des rsa 2015\nirum(finess = 750100042, annee = 2015, mois = 12, path = '~/Documents/data/mco')\n```\n\nSelon la nature des analyses a produire, plusieurs types d'imports sont possibles : \n\n| Type|Import                                                          |\n|----:|:---------------------------------------------------------------|\n|    1|XLight    : Partie fixe                                         |\n|    2|Light     : Partie fixe + stream en ligne des actes, das et dad |\n|    3|Standard  : Partie fixe + table actes, das, dad                 |\n|    4|Standard+ : Partie fixe + stream + table actes, das, dad        |\n\n#### Colonnes stream\n\n**Exemples sur quelques rsa** : \n\n  - actes : Actes CCAM du Rsa\n\n| Cle RSA  |  actes                                 |\n|---------:|:---------------------------------------|\n|0000000001|      EDSF004, EDSF004, JQGA004, JQGA004|\n|0000000002|      EPLF002, DEQP003, DEQP007, DZQM006|\n|0000000003|               EBQH002, EEQH002, YYYY180|\n \n\n  - dpdrum : zones diagnostics des passages UM du Rsa\n\n| Cle RSA  |  dpdrum                   |                  \n|---------:|:--------------------------|\n|0000000004|                 Z098  I671|\n|0000000005|           Z380, P741, Z380|\n\n  - das : zones diagnostics associes du Rsa\n\n| Cle RSA  |  das                                               |\n|---------:|:---------------------------------------------------|\n|0000000006|                                        Z9580, Z9588|\n|0000000007|P011, P032, P036, P011, P032, P700, P011, P032, P036|\n\n  - um : types autorisations T2A des um de passage par ordre chronologique\n\n| Cle RSA  |  um                    |\n|---------:|:-----------------------|\n|0000000009|              01AC, 53 C|\n|0000000010|                    51 C|\n|0000000011|        71 C, 04 C, 71 C|\n\n### TRA\n\nLe fichier TRA est un fichier du *out* qui permet de relier les donnees anonymes du *out* aux donnees du *in*, il comprend un lien entre : \n\n  - MCO : cle_rsa, numero de rss, numero de sejour (nas), date d'entree et date de sortie du sejour\n  - SSR : numero sequentiel du sejour + noseqrhs et numero de sejour + numero de semaine\n  - PSY RPSA : ipp, date d'entree et de fin du sejour, numero sequentiel du sejour, numero de sequence et numero de sejour, dates de debut et fin de sequence\n  - PSY R3A : ipp, date de l'acte, numero d'ordre, forme activitÃ©, um, nature et lieu de l'acte\n  - HAD : numero sequentiel de sejour, numero de sequence, sous-sequence et numero de sejour, dates de debut et fin des sequences et sous-sequences, dates d'entree et de sortie du sejour, modes d'entree sortie provenance destination\n\n\n| Type     |Import                              |\n|---------:|:-----------------------------------|\n|[itra](https://github.com/IM-APHP/pmeasyr/tree/master/Rd_md/itra.Rmd)      |~ TRA - Import du TRA               |\n|[inner_tra](https://github.com/IM-APHP/pmeasyr/tree/master/Rd_md/inner_tra.Rmd) |~ TRA - Ajout du TRA aux donnees Out|\n\n\n```{r eval = F}\n# lecture du fichier tra et jointure aux rsa\nitra(750100042, 2015, 12, '~/Documents/data/mco') -> tra\n# Ajout du tra aux rsa :\ninner_tra(rsa15$rsa, tra) -> rsa15$rsa\n```\n\n### Champ HAD, SSR, PSY et RSF\n\nPour ces quatre champs, seules les donnees du out sont prises en charge par le package pour le moment.\nLes fichiers tra sont egalement lus (ce qui permet de rattacher les informations du *out* au numeros des sejours locaux - du *in*).\n\nLes fonctions d'imports pour ces trois champs reposent sur le meme principe qu'en MCO.\n\n#### HAD\n\n|Nom        |Fonction                              |\n|:----------|:-------------------------------------|\n|[iano_had](https://github.com/IM-APHP/pmeasyr/tree/master/Rd_md/iano_had.Rmd)   |~ HAD - Import des Anohosp            |\n|[imed_had](https://github.com/IM-APHP/pmeasyr/tree/master/Rd_md/imed_had.Rmd)   |~ HAD - Import des Med                |\n|[irapss](https://github.com/IM-APHP/pmeasyr/tree/master/Rd_md/irapss.Rmd)     |~ HAD - Import des RAPSS              |\n\n#### SSR\n\n|Nom        |Fonction                              |\n|:----------|:-------------------------------------|\n|[iano_ssr](https://github.com/IM-APHP/pmeasyr/tree/master/Rd_md/iano_ssr.Rmd)   |~ SSR - Import des Anohosp            |\n|[irha](https://github.com/IM-APHP/pmeasyr/tree/master/Rd_md/irha.Rmd)       |~ SSR - Import des RHA                |\n|[issrha](https://github.com/IM-APHP/pmeasyr/tree/master/Rd_md/issrha.Rmd)     |~ SSR - Import des SSRHA              |\n\n\n#### PSY \n|Nom        |Fonction                              |\n|:----------|:-------------------------------------|\n|[iano_psy](https://github.com/IM-APHP/pmeasyr/tree/master/Rd_md/iano_psy.Rmd)   |~ PSY - Import des Anohosp            |\n|[ir3a](https://github.com/IM-APHP/pmeasyr/tree/master/Rd_md/ir3a.Rmd)       |~ PSY - Import des R3A                |\n|[irpsa](https://github.com/IM-APHP/pmeasyr/tree/master/Rd_md/irpsa.Rmd)      |~ PSY - Import des RPSA               |\n\n#### RSF\n\n|Nom        |Fonction                              |\n|:----------|:-------------------------------------|\n|[irafael](https://github.com/IM-APHP/pmeasyr/tree/master/Rd_md/irafael.Rmd)    |~ RSF - Import des RSFA / Rafael      |\n|[iano_rafael](https://github.com/IM-APHP/pmeasyr/tree/master/Rd_md/iano_rafael.Rmd)|~ RSF - Import des RSFA / ANO         |\n\n### Dico\n\n```{r eval = F}\n# Obtenir les noms, labels et types de variables (character, numeric, integer, date, ...)\ndico(rsa15$rsa)\n```\n\n### Tidy diagnostics\n\nLes analyses sur les diagnostics CIM-10 sont parfois fastidieuses du fait des multiples positions de diagnostics : DP principal du sejour, DR principal du sejour, DPUM, DRUM, DAS. La fonction *tdiag* permet de rassembler tous les diagnostics dans une seule table.\n\n```{r eval = F}\n# Pour les objets rsa et rum du MCO\n# Transbahuter tous les diagnostics dans une seule table\ntdiag(rsa15) -> rsa15\nView(rsa15$diags)\n# Tous les diagnostics sont dans une table, avec un numero selon leur position  \n# 1:DP, 2:DR, 3:DPUM, 4:DRUM, 5:DAS\n```\n\nExemple : \n\n|CLE_RSA   |NSEQRUM|position| diag |\n|:---------|:------|--------|------|\n|0000000001|     01|       1|  Z511|\n|0000000001|     01|       2|   C18|\n|0000000002|     01|       1|  C501|\n|0000000002|     01|       3|  C501|\n|0000000002|     02|       1|  D051|\n|0000000002|     02|       5|  E109|\n\n## 3 - Exemples de requetes\n\n### Nombre de rsa avec un acte\n\n```{r eval = F}\n# En utilisant le package dplyr\nlibrary(dplyr)\n# acte EBLA003\nrsa15$rsa %>% filter(grepl('EBLA003', actes)) %>% nrow()\n\n# actes EBLA001 ou EBLA002 ou EBLA003\nrsa15$rsa %>% filter(grepl('EBLA', actes)) %>% nrow()\n\n# actes EBLA003 ou EPLF002\nrsa15$rsa %>% filter(grepl('EBLA003|EPLF002', actes)) %>% nrow()\n\n# directement dans la table actes \nrsa15$actes %>% filter(CDCCAM %in% c('EBLA003', 'EPLF002'))  %>% \n  .$CLE_RSA %>% unique() %>% length()\n```\n\n### Nombre de rsa avec un diagnostic\n\n```{r eval = F}\n# Diagnostic categorie cancer du colon en toutes positions\nrsa15$rsa %>% filter(grepl('C18', dpdrum)|grepl('C18', das)) %>% nrow()\n\n# Autrement apres avoir utilise tdiag() :\nrsa15$diags %>% filter(grepl('C18', diag)) %>% \n  .$CLE_RSA %>% unique() %>% length()\n\n# En restreignant au dp dr du sejour (avec la variable position)\nrsa15$diags %>% filter(grepl('C18', diag), position < 3) %>% \n  .$CLE_RSA %>% unique() %>% length()\n```\n\n## 4 - Help\n\nToutes les fonctions du package ont une page d'aide.\n\n```{r eval = F}\nlibrary(pmeasyr)\n?irsa\n?irum\n\n?itra\n?inner_tra\n```\n\n## 5 - Format des donnees\n\nLe package comprend une table des formats des fichiers PMSI. Ce sont les formats inscrits dans les manuels techniques ATIH des logiciels relatifs aux champs MCO, SSR, HAD, PSY et RSF, respectivement [Genrsa](http://atih.sante.fr/plateformes-de-transmission-et-logiciels/logiciels-espace-de-telechargement#G), [Genrha](http://atih.sante.fr/plateformes-de-transmission-et-logiciels/logiciels-espace-de-telechargement#G), [Paprica](http://atih.sante.fr/plateformes-de-transmission-et-logiciels/logiciels-espace-de-telechargement#P), [Pivoine](http://atih.sante.fr/plateformes-de-transmission-et-logiciels/logiciels-espace-de-telechargement#P) et [Preface](http://atih.sante.fr/plateformes-de-transmission-et-logiciels/logiciels-espace-de-telechargement#P). On peut obtenir ces manuels pdf dans l'[espace de telechargement](http://atih.sante.fr/plateformes-de-transmission-et-logiciels/logiciels-espace-de-telechargement) sur le site de l'ATIH.\n\nC'est le seul jeu de donnees inclus dans le package.\n\n```{r eval = F}\n# Charger les formats des donnees\npmeasyr::formats\n```\n\n",
    "created" : 1486708658009.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1411108663",
    "id" : "B4E0D69D",
    "lastKnownWriteTime" : 1485748189,
    "last_content_update" : 1485748189,
    "path" : "~/Documents/github2/pmeasyr/vignettes/vignette.Rmd",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 7,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}